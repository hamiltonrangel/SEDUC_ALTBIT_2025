<!DOCTYPE html>
<!-- Declaração do tipo de documento HTML5 -->
<html lang="pt-br">
<!-- Início do documento HTML com idioma português brasileiro -->
<head>
  <!-- Seção head contém metadados e configurações da página -->
  <meta charset="UTF-8">
  <!-- Define a codificação de caracteres como UTF-8 para suportar acentos -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Configuração para responsividade em dispositivos móveis -->
  <title>Cadastro de Equipamento</title>
  <!-- Título que aparece na aba do navegador -->
  
  <style>
    /* Início das regras CSS para estilização da página */
    
    /* Reset básico para remover margens e paddings padrão do navegador */
    html, body {
      margin: 0;          /* Remove margem externa */
      padding: 0;         /* Remove espaçamento interno */
      height: 100%;       /* Define altura como 100% da tela */
      width: 100%;        /* Define largura como 100% da tela */
      font-family: Arial, sans-serif;  /* Define fonte padrão */
      background-color: #f9f9f9;       /* Cor de fundo cinza claro */
    }

    /* Estilização do título principal */
    h2 {
      text-align: center;  /* Centraliza o texto */
      margin: 20px 0;      /* Margem superior e inferior de 20px */
    }

    /* Estilização do formulário */
    form {
      padding: 20px;       /* Espaçamento interno de 20px */
      width: 100%;         /* Largura total disponível */
      box-sizing: border-box;  /* Inclui padding e border no cálculo da largura */
    }

    /* Estilização das labels (rótulos dos campos) */
    label {
      display: block;      /* Cada label ocupa uma linha inteira */
      margin-top: 15px;    /* Margem superior de 15px */
      font-weight: bold;   /* Texto em negrito */
    }

    /* Estilização dos campos de entrada, seleção e botões */
    select, input, button {
      width: 100%;         /* Largura total disponível */
      padding: 10px;       /* Espaçamento interno de 10px */
      margin-top: 5px;     /* Margem superior de 5px */
      border-radius: 5px;  /* Bordas arredondadas */
      border: 1px solid #ccc;  /* Borda cinza clara */
      font-size: 16px;     /* Tamanho da fonte */
      box-sizing: border-box;  /* Inclui padding e border no cálculo da largura */
    }

    /* Estilização específica dos botões */
    button {
      margin-top: 20px;    /* Margem superior maior para separar dos campos */
      background-color: #4CAF50;  /* Cor de fundo verde */
      color: white;        /* Texto branco */
      border: none;        /* Remove borda padrão */
      font-size: 18px;     /* Fonte maior para botões */
      cursor: pointer;     /* Cursor de ponteiro ao passar o mouse */
      transition: background-color 0.3s;  /* Transição suave na mudança de cor */
    }

    /* Efeito hover nos botões (quando o mouse passa por cima) */
    button:hover {
      background-color: #45a049;  /* Verde mais escuro no hover */
    }

    /* Estilização do botão de limpar com cor diferente */
    .btn-limpar {
      background-color: #f44336;  /* Cor vermelha para o botão de limpar */
    }

    /* Efeito hover no botão de limpar */
    .btn-limpar:hover {
      background-color: #da190b;  /* Vermelho mais escuro no hover */
    }

    /* Estilização da seção de informações (contador e lista) */
    .info-section {
      margin: 20px;        /* Margem externa de 20px */
      padding: 15px;       /* Espaçamento interno de 15px */
      background-color: #e8f5e8;  /* Fundo verde claro */
      border-radius: 8px;  /* Bordas arredondadas */
      border: 1px solid #4CAF50;  /* Borda verde */
    }

    /* Estilização do contador */
    .contador {
      text-align: center;  /* Centraliza o texto */
      font-size: 18px;     /* Fonte maior */
      font-weight: bold;   /* Texto em negrito */
      color: #2e7d32;      /* Cor verde escura */
      margin-bottom: 15px; /* Margem inferior */
    }

    /* Estilização da mensagem de sucesso */
    .status-sucesso {
      text-align: center;  /* Centraliza o texto */
      font-weight: bold;   /* Texto em negrito */
      color: #2e7d32;      /* Cor verde escura */
      background-color: #c8e6c9;  /* Fundo verde muito claro */
      padding: 10px;       /* Espaçamento interno */
      border-radius: 5px;  /* Bordas arredondadas */
      margin-bottom: 15px; /* Margem inferior */
      display: none;       /* Inicialmente oculta */
    }

    /* Estilização da área da lista de cadastros */
    .lista-cadastros {
      background-color: #f1f8e9;  /* Fundo verde muito claro */
      padding: 10px;       /* Espaçamento interno */
      border-radius: 5px;  /* Bordas arredondadas */
      border-left: 4px solid #4CAF50;  /* Borda esquerda verde destacada */
      max-height: 300px;   /* Altura máxima de 300px */
      overflow-y: auto;    /* Scroll vertical quando necessário */
    }

    /* Estilização do título da lista */
    .lista-cadastros h4 {
      margin: 0 0 10px 0;  /* Remove margem superior, mantém inferior */
      color: #2e7d32;      /* Cor verde escura */
      font-size: 16px;     /* Tamanho da fonte */
    }

    /* Estilização de cada item da lista de cadastros */
    .cadastro-item {
      background-color: #ffffff;  /* Fundo branco */
      margin-bottom: 8px;  /* Margem inferior entre itens */
      padding: 8px;        /* Espaçamento interno */
      border-radius: 4px;  /* Bordas arredondadas */
      border: 1px solid #e0e0e0;  /* Borda cinza clara */
      font-size: 14px;     /* Tamanho da fonte */
      line-height: 1.4;    /* Altura da linha para melhor legibilidade */
    }

    /* Remove margem do último item da lista */
    .cadastro-item:last-child {
      margin-bottom: 0;
    }

    /* Estilização do texto em negrito nos itens */
    .cadastro-item strong {
      color: #1b5e20;      /* Verde mais escuro para destaque */
    }

    /* Estilização do número do cadastro */
    .cadastro-numero {
      background-color: #4CAF50;  /* Fundo verde */
      color: white;        /* Texto branco */
      padding: 2px 6px;    /* Espaçamento interno pequeno */
      border-radius: 3px;  /* Bordas arredondadas */
      font-size: 12px;     /* Fonte menor */
      font-weight: bold;   /* Texto em negrito */
      margin-right: 8px;   /* Margem direita para separar do texto */
    }
  </style>
</head>
<body>
  <!-- Início do corpo da página -->
  
  <!-- Título principal da página -->
  <h2>Cadastro de Equipamento</h2>

  <!-- Formulário de cadastro -->
  <form id="formulario">
    <!-- Campo para número do patrimônio -->
    <label>Patrimônio:
      <input type="text" name="patrimonio" id="patrimonio" required>
      <!-- required: torna o campo obrigatório -->
    </label>

    <!-- Campo de seleção para tipo de equipamento -->
    <label>Equipamento:
      <select name="equipamento" id="equipamento" required>
        <option value="">Selecione</option>  <!-- Opção padrão vazia -->
        <option value="Mini-PC">Mini-PC</option>
        <option value="Desktop">Desktop</option>
        <option value="Notebook">Notebook</option>
        <option value="Monitor">Monitor</option>
      </select>
    </label>

    <!-- Campo de seleção para secretaria -->
    <label>Secretaria:
      <select name="secretaria" id="secretaria" required>
        <option value="">Selecione</option>  <!-- Opção padrão vazia -->
        <option value="SEDUC">SEDUC</option>
        <option value="SESAU">SESAU</option>
        <option value="SEPLAN">SEPLAN</option>
      </select>
    </label>

    <!-- Campo de seleção para escola -->
    <label>Escola:
      <select name="escola" id="escola" required>
        <option value="">Selecione</option>
      </select>
    </label>

    <!-- Botão para enviar o formulário -->
    <button type="submit">Enviar</button>
    
    <!-- Botão para limpar o formulário e contador -->
    <button type="button" class="btn-limpar" id="btnLimpar">Limpar Formulário e Contador</button>
    <!-- type="button": impede que o botão envie o formulário -->
  </form>
  
  <!-- Seção de informações (contador, status e lista de cadastros) -->
  <!-- Inicialmente oculta, só aparece após o primeiro cadastro -->
  <div class="info-section" id="infoSection" style="display: none;">
    <!-- Contador de cadastros -->
    <div class="contador" id="contador">
      Total de Cadastros: 0
    </div>
    
    <!-- Mensagem de sucesso (aparece temporariamente após envio) -->
    <div class="status-sucesso" id="statusSucesso">
      Enviado com sucesso!
    </div>
    
    <!-- Área da lista de cadastros -->
    <div class="lista-cadastros" id="listaCadastros">
      <h4>Histórico de Cadastros:</h4>
      <!-- Conteúdo da lista será preenchido dinamicamente pelo JavaScript -->
      <div id="listaCadastrosConteudo">
        Nenhum cadastro realizado ainda.
      </div>
    </div>
  </div>

  <script>
    /* Início do código JavaScript */
    
    // Variáveis globais para armazenar dados na sessão atual
    let contadorCadastros = 0;  // Contador que zera ao recarregar a página
    let listaCadastros = [];    // Array para armazenar todos os cadastros da sessão

    // Lista de escolas
    const escolas = [
      "Creche Diva Bernardino",
      "EMEI Mundo Encantado",
      "EM Profª Joana Alves dos Reis",
      "EM Profª Cynthia Cliquet Luciano",
      "Creche da Enseada (Maria Leonarda da Costa)",
      "EM Solange de Paula",
      "EMEI Pônei Azul",
      "EM Profª Maria Alice Rangel",
      "EMEI Elefante Colorido",
      "Creche Débora Tavares Bahia",
      "Berçário Amigos da Criança",
      "EMEI Luciana da Silveira Gonçalves Chapeuzinho Vermelho",
      "Creche Dona Laurinda",
      "EMEI Sebastião Leme da Silva Pingo de Gente",
      "EM Profº Walfrido Maciel Monteiro",
      "EMEI Iraydes Lobo Viana do Rego Algodão Doce",
      "Creche Semírames Tavolaro Passos",
      "EM Profª Maria Francisca Santana de Moura Tavolaro",
      "EM Profº Dr. José Machado Rosa",
      "EMEI Profª Emília Pinder Peteleco",
      "EM Henrique Botelho",
      "Creche São Sebastião",
      "Berçário Santana II",
      "Creche Maria Fernanda Moraes Mendes",
      "Creche Adriana Vasques Fernandes (Berçário Santana I)",
      "Creche e EMEI Meire Vasques dos Santos",
      "EMEI Profª Teresa Mota Santos Reino da Alegria",
      "EM Profª Verena de Oliveira Dória",
      "EM Profª Iraydes Lobo Vianna do Rego",
      "EM Profª Patrícia Viviani Santana",
      "Creche Eugênia Andrada Abreu",
      "Creche de Barequeçaba",
      "EM de Barequeçaba",
      "EMEI Arco-Íris",
      "EM Profª Luiza Helena de Barros",
      "EM Profº João Gabriel de Sant'Ana",
      "EMEI Bolinha de Sabão",
      "Creche de Maresias",
      "Creche Gabriel Almeida Teixeira Lobo",
      "EMEI Arlete Nascimento Moura",
      "EM Profª Edilleusa Brasil Soares de Souza",
      "Creche de Boiçucanga I",
      "Creche de Boiçucanga Unidade II",
      "EMEI Gilmar Furtado de Oliveira Alegria das Crianças",
      "EM Profª Guiomar Aparecida da Conceição Souza",
      "EM Profº Antonio Luiz Monteiro",
      "Creche de Camburi",
      "EM de Camburi",
      "EMEI Profº Lino Marques Vicente Sementinha",
      "EM Mathew Lucca Carmo Damasceno",
      "EM Maria da Conceição de Deus Santos",
      "EMEI Cavalinho de Pau",
      "Creche da Barra do Sahy",
      "EM Henrique Tavares de Jesus",
      "EMEI Sonho de Criança",
      "Creche de Juquehy I",
      "Creche Leonardo de Jesus Santos",
      "Creche de Juquehy Unidade 3",
      "EMEI Profº Manoel Ferreira Matos Branca de Neve",
      "EM Profª Nair Ribeiro de Almeida",
      "Creche Gabriela Silva Oliveira dos Santos",
      "EM Profª Maria Virgínia Silva",
      "EMEI Pir Lim Pim Pim",
      "EM Profª Sebastiana Costa Bittencourt",
      "Creche Peraltinha",
      "EM Profª Vilma Aparecida de Almeida Ribas",
      "EMEI Carrossel"
    ];

    /**
     * Função para popular o combobox de escolas
     */
    function popularEscolas() {
      const selectEscola = document.getElementById('escola');
      escolas.forEach(escola => {
        const option = document.createElement('option');
        option.value = escola;
        option.textContent = escola;
        selectEscola.appendChild(option);
      });
    }

    /**
     * Função para atualizar a exibição do contador na tela
     * Atualiza o texto do contador e mostra/oculta a seção de informações
     */
    function atualizarContador() {
      // Busca o elemento do contador no DOM e atualiza o texto
      document.getElementById('contador').textContent = `Total de Cadastros: ${contadorCadastros}`;
      
      // Mostra a seção de informações se houver pelo menos 1 cadastro
      if (contadorCadastros > 0) {
        document.getElementById('infoSection').style.display = 'block';
      } else {
        // Oculta a seção se não houver cadastros
        document.getElementById('infoSection').style.display = 'none';
      }
    }

    /**
     * Função para atualizar a exibição da lista de cadastros
     * Percorre o array de cadastros e gera o HTML para cada item
     */
    function atualizarListaCadastros() {
      // Busca o elemento que conterá a lista no DOM
      const conteudoElement = document.getElementById('listaCadastrosConteudo');
      
      // Verifica se há cadastros na lista
      if (listaCadastros.length > 0) {
        let html = '';  // String para armazenar o HTML gerado
        
        // Percorre cada cadastro na lista usando forEach
        listaCadastros.forEach((cadastro, index) => {
          // Converte o timestamp para formato brasileiro de data/hora
          const dataHora = new Date(cadastro.timestamp).toLocaleString('pt-BR');
          
          // Gera o HTML para cada item da lista
          html += `
            <div class="cadastro-item">
              <span class="cadastro-numero">#${index + 1}</span>
              <strong>Patrimônio:</strong> ${cadastro.patrimonio} | 
              <strong>Equipamento:</strong> ${cadastro.equipamento} | 
              <strong>Secretaria:</strong> ${cadastro.secretaria} | 
              <strong>Escola:</strong> ${cadastro.escola} | 
              <strong>Data/Hora:</strong> ${dataHora}
            </div>
          `;
        });
        
        // Insere o HTML gerado no elemento
        conteudoElement.innerHTML = html;
      } else {
        // Se não há cadastros, mostra mensagem padrão
        conteudoElement.textContent = 'Nenhum cadastro realizado ainda.';
      }
    }

    /**
     * Função para mostrar a mensagem de sucesso temporariamente
     * Exibe a mensagem por 3 segundos e depois a oculta
     */
    function mostrarMensagemSucesso() {
      // Busca o elemento da mensagem de sucesso
      const statusElement = document.getElementById('statusSucesso');
      statusElement.style.display = 'block';  // Torna visível
      
      // Usa setTimeout para ocultar a mensagem após 3 segundos (3000ms)
      setTimeout(() => {
        statusElement.style.display = 'none';  // Oculta novamente
      }, 3000);
    }

    /**
     * Função para limpar todos os dados (formulário, contador e lista)
     * Reseta todas as variáveis e atualiza a interface
     */
    function limparTudo() {
      // Reset das variáveis globais
      contadorCadastros = 0;
      listaCadastros = [];
      
      // Limpa todos os campos do formulário
      document.getElementById('formulario').reset();
      
      // Atualiza as exibições na tela
      atualizarContador();
      atualizarListaCadastros();
      
      // Foca no campo patrimônio para facilitar novo cadastro
      document.getElementById('patrimonio').focus();
      
      // Mostra confirmação da limpeza
      alert('Formulário e contador limpos com sucesso!');
    }

    /**
     * Event listener que executa quando a página termina de carregar
     * Inicializa a interface com valores padrão
     */
    document.addEventListener('DOMContentLoaded', function() {
      // Atualiza as exibições iniciais (contador zerado e lista vazia)
      atualizarContador();
      atualizarListaCadastros();
      popularEscolas(); // Popula o combobox de escolas
      
      // Foca automaticamente no campo patrimônio
      document.getElementById('patrimonio').focus();
    });

    /**
     * Event listener para o envio do formulário
     * Intercepta o envio, processa os dados e envia para o Google Sheets
     */
    document.getElementById('formulario').addEventListener('submit', function(e) {
      // Previne o comportamento padrão de envio do formulário
      e.preventDefault();

      // Cria um objeto FormData com os dados do formulário
      const form = new FormData(this);
      
      // URL do Google Apps Script para processar os dados
      const url = 'https://script.google.com/macros/s/AKfycbzmxe6VLNJAKg2DBtewcvtvkj9Dr7Z3iGsmxGD4uKGr051RsnuVRJpY6MfnTPmTnuiX/exec';
      //https://script.google.com/macros/s/AKfycbwdcj0NnBR3vbQHSG4FQzT7RqTL5eW1CbuaKlNIjxKcGF79midp53IDjDVwsGwSzibE/exec

      // Captura os dados do formulário antes do envio para armazenar localmente
      const dadosCadastro = {
        patrimonio: document.getElementById("patrimonio").value,
        equipamento: document.getElementById("equipamento").value,
        secretaria: document.getElementById("secretaria").value,
        escola: document.getElementById("escola").value,
        timestamp: new Date().toISOString()  // Timestamp atual em formato ISO
      };

      // Envia os dados usando fetch API
      fetch(url, {
        method: 'POST',  // Método HTTP POST
        body: new URLSearchParams(form)  // Converte FormData para formato URL-encoded
      })
      .then(res => res.text())  // Converte resposta para texto
      .then(msg => {
        // Código executado quando o envio é bem-sucedido
        
        // Incrementa o contador de cadastros
        contadorCadastros++;
        
        // Adiciona o novo cadastro ao final da lista
        listaCadastros.push(dadosCadastro);
        
        // Atualiza as exibições na tela
        atualizarContador();
        atualizarListaCadastros();
        
        // Mostra mensagem de sucesso temporária
        mostrarMensagemSucesso();
        
        // Limpa apenas o campo patrimônio para facilitar próximo cadastro
        document.getElementById('patrimonio').value = '';
        
        // Retorna o foco para o campo patrimônio
        document.getElementById('patrimonio').focus();
      })
      .catch(err => {
        // Código executado em caso de erro no envio
        alert('Erro ao enviar! Tente novamente.');
        console.error(err);  // Log do erro no console para debug
      });
    });

    /**
     * Event listener para o botão de limpar
     * Executa a função de limpeza quando o botão é clicado
     */
    document.getElementById('btnLimpar').addEventListener('click', function() {
      // Pede confirmação antes de limpar
      if (confirm('Tem certeza que deseja limpar o formulário e zerar o contador?')) {
        limparTudo();  // Executa a limpeza se confirmado
      }
    });
  </script>
</body>
</html>
<!-- Fim do documento HTML -->
